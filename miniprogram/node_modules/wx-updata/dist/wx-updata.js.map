{"version":3,"file":"wx-updata.js","sources":["../src/utils.js","../src/index.js"],"sourcesContent":["export function isArray(tar) {\n    return Array.isArray(tar)\n}\n\nexport function isObject(tar) {\n    return (typeof tar === 'object') && (tar !== null) && !isArray(tar)\n}\n","import { isObject, isArray } from './utils'\n\n/**\n * 处理数组\n * @param value 当前值\n * @param curPath 当前路径\n * @param store 结果\n * @param config arrObjPath:是否开启数组路径表示功能\n */\nconst handleArray = (value, curPath, store, config = {}) => {\n    value.forEach((item, idx) => {        // forEach 会跳过数组空位\n        if (item !== Empty) {\n            const arrPath = `${ curPath }[${ idx }]`  // 拼接数组路径\n            if (isObject(item)) {\n                if (config.arrObjPath) {\n                    objToPath(item, arrPath + (Object.keys(item).every(key => /^\\[\\d+]$/.test(key) || config.arrObjPath) ? '' : '.'), store, config)\n                } else {\n                    objToPath(item, arrPath + '.', store, config)\n                }\n            } else if (isArray(item)) {\n                handleArray(item, arrPath, store)\n            } else {\n                store[arrPath] = item\n            }\n        }\n    })\n}\n\n// 可以使用 Symbol 跳过数组项\nexport const Empty = Symbol('updata empty array item')\n\n/**\n * 对象转化为路径格式对象\n * @param obj 要转化的对象\n * @param prefix 路径前缀\n * @param store 结果\n * @param config arrObjPath:是否开启数组路径表示功能\n * @return {{}}\n */\nexport const objToPath = (obj,\n                          prefix = '',\n                          store = {},\n                          config = {}) => {\n    if (typeof prefix !== 'string') {  // 参数重载\n        config = prefix\n        prefix = ''\n    }\n    let arrPath = false  // 判断是否是数组路径\n    if (config.arrObjPath) {\n        if (Object.keys(obj).every(key => /^\\[\\d+]$/.test(key))) {\n            arrPath = true\n        } else if (!Object.keys(obj).some(key => /^\\[\\d+]$/.test(key))) {\n            arrPath = false\n        } else {\n            throw new Error('wx-updata: 数组路径对象需要每个属性都是对象路径 [数组下标] 形式')\n        }\n    }\n\n    for (const [key, value] of Object.entries(obj)) {\n        const curPath = prefix === ''  // 当前路径\n          ? key\n          : (prefix.endsWith('].') || arrPath)\n            ? `${ prefix }${ key }`\n            : `${ prefix }.${ key }`\n\n        if (isObject(value)) {                    // 是对象\n            objToPath(value, curPath, store, config)\n        } else if (!config.arrCover && isArray(value)) {              // 是数组\n            handleArray(value, curPath, store, config)\n        } else {\n            store[curPath] = value\n        }\n    }\n    return store\n}\n\n/**\n * 将函数挂载到 page 实例上\n * @param Page\n * @returns {function(any=): any}\n * @param conf\n */\nexport const updataInit = (Page, conf) => {\n    const originalPage = Page\n    return function(config) {\n        config.upData = function(data, func) {\n            const result = objToPath(data, { arrObjPath: conf.arrObjPath ?? false, arrCover: conf.arrCover ?? false })\n            if (conf.debug) {\n                console.log('转化后效果:', result)\n            }\n            return this.setData(result, func)\n        }\n        return originalPage(config)\n    }\n}\n"],"names":["isArray","tar","Array","isObject","_typeof","handleArray","value","curPath","store","config","forEach","item","idx","Empty","arrPath","arrObjPath","objToPath","Object","keys","every","key","test","Symbol","obj","prefix","some","Error","entries","endsWith","arrCover","updataInit","Page","conf","originalPage","upData","data","func","result","debug","console","log","this","setData"],"mappings":"4qCAAO,SAASA,EAAQC,UACbC,MAAMF,QAAQC,GAGlB,SAASE,EAASF,SACE,WAAfG,EAAOH,IAA8B,OAARA,IAAkBD,EAAQC,GCInE,IAAMI,EAAc,SAAdA,EAAeC,EAAOC,EAASC,OAAOC,yDAAS,GACjDH,EAAMI,SAAQ,SAACC,EAAMC,MACbD,IAASE,EAAO,KACVC,YAAcP,cAAaK,OAC7BT,EAASQ,GACLF,EAAOM,WACPC,EAAUL,EAAMG,GAAWG,OAAOC,KAAKP,GAAMQ,OAAM,SAAAC,SAAO,WAAWC,KAAKD,IAAQX,EAAOM,cAAc,GAAK,KAAMP,EAAOC,GAEzHO,EAAUL,EAAMG,EAAU,IAAKN,EAAOC,GAEnCT,EAAQW,GACfN,EAAYM,EAAMG,EAASN,GAE3BA,EAAMM,GAAWH,OAOpBE,EAAQS,OAAO,2BAUfN,EAAY,SAAZA,EAAaO,OACAC,yDAAS,GACThB,yDAAQ,GACRC,yDAAS,GACT,iBAAXe,IACPf,EAASe,EACTA,EAAS,QAETV,GAAU,KACVL,EAAOM,cACHE,OAAOC,KAAKK,GAAKJ,OAAM,SAAAC,SAAO,WAAWC,KAAKD,MAC9CN,GAAU,MACP,CAAA,GAAKG,OAAOC,KAAKK,GAAKE,MAAK,SAAAL,SAAO,WAAWC,KAAKD,YAG/C,IAAIM,MAAM,2CAFhBZ,GAAU,gBAMSG,OAAOU,QAAQJ,kBAAM,iBAApCH,OAAKd,OACPC,EAAqB,KAAXiB,EACZJ,EACCI,EAAOI,SAAS,OAASd,YACpBU,UAAWJ,aACXI,cAAYJ,GAElBjB,EAASG,GACTU,EAAUV,EAAOC,EAASC,EAAOC,IACzBA,EAAOoB,UAAY7B,EAAQM,GACnCD,EAAYC,EAAOC,EAASC,EAAOC,GAEnCD,EAAMD,GAAWD,SAGlBE,GASEsB,EAAa,SAACC,EAAMC,OACvBC,EAAeF,SACd,SAAStB,UACZA,EAAOyB,OAAS,SAASC,EAAMC,WACrBC,EAASrB,EAAUmB,EAAM,CAAEpB,qBAAYiB,EAAKjB,2BAAqBc,mBAAUG,EAAKH,kCAClFG,EAAKM,OACLC,QAAQC,IAAI,SAAUH,GAEnBI,KAAKC,QAAQL,EAAQD,IAEzBH,EAAaxB"}